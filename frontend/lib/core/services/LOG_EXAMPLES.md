# Intent Routing 로그 예시

## 📝 채팅 진행 시 로그

### Case 1: 연애 질문 (필터링 적용)

```
╔══════════════════════════════════════════════════════════════╗
║  🚀 [1] CHAT SEND START (v6.0 리팩토링)                      ║
╚══════════════════════════════════════════════════════════════╝
   📌 페르소나: 아기동자
   📌 세션: abc-123-def
   📌 일반 채팅 모드

┌──────────────────────────────────────────────────────────────┐
│  🎯 INTENT CLASSIFICATION (v7.0)                             │
└──────────────────────────────────────────────────────────────┘
[IntentClassifier] 분류 시작: 요즘 연애가 잘 안 풀리는데 이유...
[IntentClassifier] ✅ 분류 완료: 연애
   📌 분류 결과: 연애
   💡 이유: 연애에 대한 질문
   💰 토큰 절약 예상: ~85%

[4] SYSTEM PROMPT BUILD (v7.0 Intent Routing)
   현재 날짜: 2026년 1월 19일
   페르소나: 아기동자
   isFirstMessageInSession: false
   
   ╔══════════════════════════════════════════════════════╗
   ║  📋 AI SUMMARY 참조 정보 (Intent Routing)           ║
   ╚══════════════════════════════════════════════════════╝
   🎯 참조 범위: 선택적 필터링
   📦 포함 섹션:
      - saju_origin (기본 정보) ✅
      - wonGuk_analysis (원국 분석) ✅
      - 💕 연애 (LOVE) ✅
   💾 토큰 절약: 약 85%
   💡 분류 이유: 연애에 대한 질문
   
   [Person1] 프로필: 신선우 (남성)
   [Person1] 생년월일: 1995년 3월 15일 (양력)
   [Person1] 사주: 있음
   
   프롬프트 길이: 1250 chars

┌──────────────────────────────────────────────────────────────┐
│  ✨ [5] AI RESPONSE RECEIVED                                 │
└──────────────────────────────────────────────────────────────┘
   📝 응답 길이: 450 chars
   🔢 토큰 사용: 850
   
╔══════════════════════════════════════════════════════════════╗
║  ✅ [7] CHAT COMPLETE                                        ║
╚══════════════════════════════════════════════════════════════╝
```

---

### Case 2: 복합 질문 (직장 + 재물)

```
┌──────────────────────────────────────────────────────────────┐
│  🎯 INTENT CLASSIFICATION (v7.0)                             │
└──────────────────────────────────────────────────────────────┘
[IntentClassifier] 분류 시작: 직장을 옮길까 고민인데, 재물운도...
[IntentClassifier] ✅ 분류 완료: 진로/직장, 재물
   📌 분류 결과: 진로/직장, 재물
   💡 이유: 직장 이직과 재물운에 대한 복합 질문
   💰 토큰 절약 예상: ~70%

[4] SYSTEM PROMPT BUILD (v7.0 Intent Routing)
   
   ╔══════════════════════════════════════════════════════╗
   ║  📋 AI SUMMARY 참조 정보 (Intent Routing)           ║
   ╚══════════════════════════════════════════════════════╝
   🎯 참조 범위: 선택적 필터링
   📦 포함 섹션:
      - saju_origin (기본 정보) ✅
      - wonGuk_analysis (원국 분석) ✅
      - 💼 진로/직장 (CAREER) ✅
      - 💰 재물 (WEALTH) ✅
   💾 토큰 절약: 약 70%
   💡 분류 이유: 직장 이직과 재물운에 대한 복합 질문
```

---

### Case 3: 종합 질문 (필터링 없음)

```
┌──────────────────────────────────────────────────────────────┐
│  🎯 INTENT CLASSIFICATION (v7.0)                             │
└──────────────────────────────────────────────────────────────┘
[IntentClassifier] 분류 시작: 올해 전체적인 운세가 궁금해요
[IntentClassifier] ✅ 분류 완료: 종합
   📌 분류 결과: 종합
   💡 이유: 전반적인 운세에 대한 종합 질문
   ⚠️ 전체 정보 포함 (GENERAL)

[4] SYSTEM PROMPT BUILD (v7.0 Intent Routing)
   
   ╔══════════════════════════════════════════════════════╗
   ║  📋 AI SUMMARY 참조 정보 (Intent Routing)           ║
   ╚══════════════════════════════════════════════════════╝
   🔵 참조 범위: 전체 (GENERAL)
   📦 포함 섹션: 모든 카테고리
   💡 분류 이유: 전반적인 운세에 대한 종합 질문
```

---

### Case 4: 첫 메시지 (필터링 없음)

```
╔══════════════════════════════════════════════════════════════╗
║  🚀 [1] CHAT SEND START (v6.0 리팩토링)                      ║
╚══════════════════════════════════════════════════════════════╝
   📌 페르소나: 아기동자
   📌 세션: abc-123-def
   📌 일반 채팅 모드

(Intent Classification 생략 - 첫 메시지는 항상 전체 포함)

[4] SYSTEM PROMPT BUILD (v7.0 Intent Routing)
   현재 날짜: 2026년 1월 19일
   페르소나: 아기동자
   isFirstMessageInSession: true
   
   ╔══════════════════════════════════════════════════════╗
   ║  📋 AI SUMMARY 참조 정보 (첫 메시지)                ║
   ╚══════════════════════════════════════════════════════╝
   🔵 참조 범위: 전체 (첫 메시지는 항상 전체 포함)
   📦 포함 섹션: 모든 카테고리
   💡 이유: 사용자 경험 최적화 (첫 인사/종합 소개)
```

---

### Case 5: 궁합 채팅 (필터링 적용)

```
╔══════════════════════════════════════════════════════════════╗
║  🚀 [1] CHAT SEND START (v6.0 리팩토링)                      ║
╚══════════════════════════════════════════════════════════════╝
   📌 페르소나: 아기동자
   📌 세션: abc-123-def
   📌 궁합 모드: person1=신선우, person2=김민지

┌──────────────────────────────────────────────────────────────┐
│  🎯 INTENT CLASSIFICATION (v7.0)                             │
└──────────────────────────────────────────────────────────────┘
[IntentClassifier] 분류 시작: 저희 결혼해도 괜찮을까요?
[IntentClassifier] ✅ 분류 완료: 결혼
   📌 분류 결과: 결혼
   💡 이유: 결혼에 대한 질문
   💰 토큰 절약 예상: ~85%

[4] SYSTEM PROMPT BUILD (v7.0 Intent Routing)
   
   ╔══════════════════════════════════════════════════════╗
   ║  📋 AI SUMMARY 참조 정보 (Intent Routing)           ║
   ╚══════════════════════════════════════════════════════╝
   🎯 참조 범위: 선택적 필터링
   📦 포함 섹션:
      - saju_origin (기본 정보) ✅
      - wonGuk_analysis (원국 분석) ✅
      - 💍 결혼 (MARRIAGE) ✅
   💾 토큰 절약: 약 85%
   💡 분류 이유: 결혼에 대한 질문
   
   [Person1] 프로필: 신선우 (남성)
   [Person1] 생년월일: 1995년 3월 15일 (양력)
   [Person1] 사주: 있음
   [Person2] 프로필: 김민지 (여성)
   [Person2] 생년월일: 1997년 5월 20일 (양력)
   [Person2] 사주: 있음
   [궁합분석] 85점
```

---

## 🔍 로그 해석 가이드

### 아이콘 의미
- 🔵 **전체 참조**: 모든 카테고리 포함 (필터링 없음)
- 🎯 **선택적 참조**: 필요한 카테고리만 포함 (필터링 적용)
- ✅ **포함됨**: 해당 섹션이 컨텍스트에 포함
- 💾 **토큰 절약**: 예상 절약률
- 💡 **분류 이유**: Gemini Flash가 판단한 이유

### 카테고리 아이콘
- 🧑 PERSONALITY (성격)
- 💕 LOVE (연애)
- 💍 MARRIAGE (결혼)
- 💼 CAREER (진로/직장)
- 🏢 BUSINESS (사업)
- 💰 WEALTH (재물)
- 🏥 HEALTH (건강)

### 토큰 절약률
- **0%**: 전체 포함 (첫 메시지 or GENERAL)
- **60-70%**: 2-3개 카테고리
- **85%**: 1개 카테고리

---

## 🐛 문제 발생 시 확인 사항

### 1. 분류가 항상 GENERAL로 나옴
```
[IntentClassifier] ⚠️ 응답 실패 (status: 500)
```
→ Gemini API 호출 오류. 네트워크 연결 및 API 키 확인

### 2. 토큰 절약이 예상보다 낮음
```
   💾 토큰 절약: 약 0%
```
→ 정상 (종합 질문이 많거나 첫 메시지가 많은 경우)

### 3. 응답이 이상함
```
   🎯 참조 범위: 선택적 필터링
   📦 포함 섹션:
      - 💰 재물 (WEALTH) ✅
```
→ 사용자가 "연애"를 물었는데 "재물"로 분류됨
→ Gemini Flash 프롬프트 튜닝 필요 (`intent_classifier_service.dart` 수정)
