# 광고 비용 계산 가이드

> **경고**: 이 문서를 반드시 읽고 계산하세요. 잘못된 계산은 막대한 적자를 초래합니다.
> 마지막 업데이트: 2026-02-02

---

## 1. 과거 계산 오류 (절대 반복 금지)

### 오류 1: eCPM과 CPC 이중 계산

```
❌ 잘못된 계산:
광고 수익 = eCPM 수익 + CPC 수익
         = $0.005 + $0.20 = $0.205

✅ 올바른 계산:
eCPM = (총 수익 / 총 노출) × 1000
     = CPC 수익이 이미 포함된 값

광고 1회 수익 = eCPM ÷ 1000
Native eCPM $5 → 1회 수익 = $0.005 (이게 전부)
```

**eCPM은 이미 클릭 수익(CPC)을 포함한 값. CPC를 별도로 더하면 이중 계산.**

### 오류 2: 잘못된 Gemini 모델 가격 사용

```
❌ 잘못된 가격 (ad_token_user_flow.md 구버전):
Gemini Flash: Input $0.10/1M, Output $0.40/1M
→ 가중 평균: $0.00000019/token

✅ 실제 사용 모델 가격:
Gemini 3.0 Flash: Input $0.50/1M, Output $3.00/1M
→ Output: $0.000003/token

차이: 7.5배 비쌈!
```

### 오류 3: 웹 검색으로 다른 모델 가격 사용

```
❌ 웹 검색 결과 (Gemini 2.5 Flash):
Output: $0.60/1M = $0.0000006/token

✅ 실제 코드 확인 필요:
supabase/functions/ai-gemini/index.ts 참조
```

---

## 2. 실제 사용 모델 및 가격

### 반드시 참조할 파일

| 파일 | 용도 |
|------|------|
| `supabase/functions/ai-gemini/index.ts` | **실제 모델 및 가격 (진실의 소스)** |
| `docs/03_command/token_window_config.md` | 토큰 윈도우 설정 |
| `frontend/lib/features/saju_chat/data/services/ad_trigger_service.dart` | 토큰 보상 설정 |

### 현재 사용 모델 (2026-02-02 기준)

**ai-gemini/index.ts 18-19줄:**
```typescript
* 채팅용: gemini-3-flash-preview
* Intent: gemini-2.5-flash-lite
```

**ai-gemini/index.ts 335줄, 441줄:**
```typescript
// Gemini 3.0 Flash: $0.50/$3.00
const cost = (promptTokens * 0.50 / 1000000) + (completionTokens * 3.00 / 1000000);
```

### 현재 가격표

| 모델 | 용도 | Input | Output |
|------|------|-------|--------|
| gemini-3-flash-preview | 채팅 | $0.50/1M | **$3.00/1M** |
| gemini-2.5-flash-lite | Intent 분류 | $0.10/1M | $0.40/1M |

---

## 3. 정확한 비용 계산

### 토큰당 비용 (채팅용 Gemini 3.0 Flash)

```
Output 토큰: $3.00 / 1,000,000 = $0.000003/token
Input 토큰:  $0.50 / 1,000,000 = $0.0000005/token

채팅은 대부분 Output이므로 $0.000003/token 기준으로 계산
```

### 토큰 수별 비용

| 토큰 수 | 비용 (Output 기준) |
|--------|-------------------|
| 1,000 | $0.003 |
| 5,000 | $0.015 |
| 10,000 | $0.030 |
| 20,000 | $0.060 |
| 30,000 | $0.090 |

---

## 4. 광고 수익

### AdMob eCPM (한국 시장, Tier 1)

| 광고 유형 | eCPM 범위 | 1회 수익 |
|----------|----------|---------|
| Rewarded Video | $15~$30 | $0.015~$0.030 |
| Native | $3~$7 | $0.003~$0.007 |
| Banner | $0.50~$1.50 | $0.0005~$0.0015 |

### 보수적 계산 기준

- **Rewarded Video**: eCPM $15 → **$0.015/회**
- **Native**: eCPM $5 → **$0.005/회**

---

## 5. 손익분기 토큰 수

### 공식

```
손익분기 토큰 = 광고 수익 ÷ 토큰당 비용
            = 광고 수익 ÷ $0.000003
```

### 계산 결과

| 광고 유형 | 수익 | 손익분기 토큰 |
|----------|------|--------------|
| Rewarded Video (eCPM $15) | $0.015 | **5,000** |
| Rewarded Video (eCPM $30) | $0.030 | 10,000 |
| Native (eCPM $5) | $0.005 | **1,666** |
| Native (eCPM $7) | $0.007 | 2,333 |

---

## 6. 권장 토큰 보상 설정

### ad_trigger_service.dart 수정 권장값

| 상수 | 현재값 (적자) | 권장값 (손익분기) | 비고 |
|------|-------------|-----------------|------|
| depletedRewardTokensVideo | 20,000 | **5,000** | eCPM $15 기준 |
| depletedRewardTokensNative | 30,000 | **1,500** | eCPM $5 기준 |
| intervalClickRewardTokens | 30,000 | **1,500** | eCPM $5 기준 |

### 현재 설정의 손익

| 광고 | 현재 토큰 | 비용 | 수익 | 손익 |
|-----|----------|------|------|------|
| Video | 20,000 | $0.060 | $0.015 | **-$0.045** |
| Native | 30,000 | $0.090 | $0.005 | **-$0.085** |

**현재 설정은 광고 1회당 $0.045~$0.085 적자**

---

## 7. 교환(왕복) 환산

### 1교환 = 유저 메시지 + AI 응답

```
1교환 ≈ 7,200 토큰 (실측 평균)
1교환 비용 ≈ 7,200 × $0.000003 = $0.0216
```

### 광고당 제공 가능 교환 수

| 광고 | 수익 | 손익분기 토큰 | 교환 수 |
|-----|------|--------------|--------|
| Video ($0.015) | $0.015 | 5,000 | **0.7회** |
| Native ($0.005) | $0.005 | 1,666 | **0.2회** |

**Gemini 3.0 Flash 가격으로는 광고 1회로 1교환도 제공 불가**

---

## 8. 대안 검토

### 옵션 A: 저렴한 모델로 변경

| 모델 | Output 가격 | 손익분기 (Video) | 손익분기 (Native) |
|------|------------|-----------------|------------------|
| Gemini 3.0 Flash | $3.00/1M | 5,000 | 1,666 |
| Gemini 2.5 Flash | $0.60/1M | 25,000 | 8,333 |
| Gemini Flash Lite | $0.40/1M | 37,500 | 12,500 |

### 옵션 B: 토큰 보상 대폭 축소

현재 모델 유지하면서 토큰 보상을 손익분기 수준으로 낮춤

### 옵션 C: 광고 횟수 증가

토큰당 보상은 낮추고, 광고 시청 횟수를 늘려 UX 보완

---

## 9. 체크리스트

비용 계산 시 반드시 확인:

- [ ] `supabase/functions/ai-gemini/index.ts`에서 실제 모델 확인
- [ ] 해당 모델의 공식 가격 확인 (코드 내 주석 또는 Google AI 공식 문서)
- [ ] eCPM과 CPC 이중 계산하지 않았는지 확인
- [ ] 손익분기 토큰 계산
- [ ] 현재 설정값과 비교하여 손익 확인

---

## 10. 참고 문서

| 문서 | 용도 | 주의사항 |
|------|------|---------|
| ad_token_user_flow.md | 유저 플로우 | **가격 정보 구버전 - 참고만** |
| token_window_config.md | 토큰 윈도우 | 가격 정보 있음 |
| ad_strategy.dart | 광고 전략 설정 | - |
| ad_trigger_service.dart | 토큰 보상 설정 | **여기를 수정** |

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-02-02 | 문서 생성. Gemini 3.0 Flash 실제 가격 기준 재계산 |
