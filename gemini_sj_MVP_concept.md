# 만톡 (Mantok) - MVP 기능 및 UX 구상

## 1. 핵심 컨셉 (Core Concept)
**"내 손안의 AI 점술가, 그리고 우리들의 관계 도감"**
- 단순한 사주 풀이를 넘어, **나와 지인들의 관계(궁합, 처세술)**를 AI와 대화하며 풀어가는 인터랙티브 서비스.
- 딱딱한 텍스트 리포트가 아닌, **채팅**을 통해 궁금한 점을 꼬리에 꼬리를 물고 물어보는 경험 제공.

---

## 2. 사용자 시나리오 (User Journey)

### Step 1: 앱 실행 및 나의 만세력 확인 (Entry)
1.  앱 실행 시 가장 먼저 **만세력 입력/확인 UI**가 표시됨.
2.  사용자 본인의 생년월일시를 입력하면, 즉시 만세력(사주팔자) 차트가 생성됨.
3.  이 데이터는 **'나의 프로필'**로 로컬 DB(Hive) 및 원격 DB(Supabase)에 저장됨.

### Step 2: 지인 만세력 DB 구축 (Relationship Building)
1.  사용자는 본인 외에 가족, 친구, 연인, 직장동료 등 **지인들의 사주**를 추가할 수 있음.
2.  **카테고리 분류**:
    -   가족 (부모, 형제, 자녀)
    -   친구 (학교, 동네)
    -   연인 (썸, 애인, 배우자)
    -   직장 (상사, 부하, 동료, 거래처)
3.  각 지인의 만세력 데이터도 DB에 구조화되어 저장됨.

### Step 3: AI 채팅 및 상담 (The Playground)
1.  **채팅방 진입**: 사용자는 AI 점술가와의 채팅방으로 이동.
2.  **대상 선택 (Context Injection)**:
    -   채팅 입력창 근처의 **'대상 선택'** 버튼 클릭.
    -   저장된 지인 목록(카테고리별)에서 상담하고 싶은 대상(예: 친구 '홍길동', 직장상사 '김부장')을 선택.
    -   *선택 시, 해당 인물의 만세력 데이터가 AI의 컨텍스트로 주입됨.*
3.  **질의 응답**:
    -   사용자: "홍길동이랑 나랑 궁합 어때? 얘 나한테 도움 되는 애야?"
    -   AI: (사용자 사주 + 홍길동 사주 + 관계성 분석) "홍길동님은 목(木) 기운이 강해서 님(화(火))에게 땔감이 되어주는 귀인입니다. 다만..."
4.  **멀티 페르소나**:
    -   단순 분석조가 아닌, "친근한 언니", "엄격한 스승님" 등 설정 가능 (추후 확장).

---

## 3. 기능 명세 (Functional Requirements)

### 3.1 만세력 관리 (Manse-ryeok Management)
-   **입력**: 생년월일(양/음/윤달), 출생시간, 성별.
-   **출력**: 4주 8자(천간/지지), 대운, 세운, 십성, 12운성 등.
-   **저장**:
    -   Local: Hive (빠른 로딩, 오프라인 지원).
    -   Remote: Supabase (기기 간 동기화, 백업).

### 3.2 관계형 데이터베이스 (Relationship DB)
-   **Profile Entity**:
    -   `id`: UUID
    -   `name`: 이름/별명
    -   `relation_type`: family, friend, lover, work, etc.
    -   `birth_data`: 생년월일시 객체
    -   `saju_data`: 계산된 만세력 JSON

### 3.3 AI 챗봇 (Gemini Integration)
-   **API**: Google Gemini 3.0 Pro (via Supabase Edge Functions).
-   **System Prompt**:
    -   역술가 페르소나 주입.
    -   입력된 JSON 데이터(사주)를 해석하는 규칙 정의.
    -   상대방과의 관계(궁합)를 분석하는 로직 가이드.
-   **Context Window**:
    -   User Saju (나)
    -   Target Saju (상대방)
    -   Chat History (이전 대화 맥락)

---

## 4. UI/UX 전략 (Flutter Implementation)

-   **Main Screen**: 내 만세력 카드 + 지인 리스트(가로 스크롤).
-   **Chat Screen**:
    -   카카오톡/텔레그램 스타일의 친숙한 UI.
    -   **Input Bar 상단**: 현재 상담 대상(Context)을 보여주는 '칩(Chip)' UI (예: [상담중: 홍길동 x]).
    -   **Quick Actions**: "궁합 보기", "오늘의 운세", "성격 파악" 등 자주 쓰는 질문 버튼.

---

## 5. 개발 로드맵 (Development Phases)

1.  **Phase 1 (완료)**: 프로젝트 기반 및 기본 만세력 로직.
2.  **Phase 4 (완료)**: 내 프로필 입력 및 저장.
3.  **Phase 5 (진행중)**:
    -   [ ] 지인 프로필 추가 및 카테고리 관리 UI 구현.
    -   [ ] 채팅 화면에서 대상 선택(Context Switching) 기능 구현.
    -   [ ] Gemini API에 두 명의 사주 데이터를 함께 보내는 프롬프트 엔지니어링.
4.  **Phase 6**: 온보딩 및 디자인 폴리싱.
