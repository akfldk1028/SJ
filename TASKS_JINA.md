# Jina's Task Log

ì´ íŒŒì¼ì€ Jinaì˜ ì‘ì—… ë‚´ì—­ê³¼ í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì´ìŠˆë¥¼ ì¶”ì í•©ë‹ˆë‹¤.

---

## ğŸ“… 2026ë…„ 01ì›” 08ì¼ 

### âœ… ì™„ë£Œëœ ì‘ì—…

1. 'ì•„ê¸°ë™ì' í˜ë¥´ì†Œë‚˜ê°€ ì‚¬ì£¼ì™€ ê´€ê³„ ì—†ëŠ” ì• ë§¤í•œ ì´ì•¼ê¸°ë¡œ ëŒ€í™”ë¥¼ ì§„í–‰í•˜ëŠ” ë¶€ë¶„ ìˆ˜ì • -> ëª¨ë“  ëŒ€í™”ëŠ” ì‚¬ì£¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, ì‚¬ìš©ìê°€ ë””í…Œì¼í•œ ë‚´ìš©ì„ ì›í•  ê²½ìš° ì ê·¹ì ìœ¼ë¡œ í’€ì´.
2. ìƒˆ í˜ë¥´ì†Œë‚˜ scenario_writer.dart "ì†¡ì‘ê°€" ì¶”ê°€ -> ê´€ê³„ë„ ì¶”ê°€ ì´í›„ ìˆ˜ì • ì˜ˆì • / ì‹œë‚˜ë¦¬ì˜¤ì˜ ê¸¸ì´ ì¶”í›„ í˜‘ì˜ í›„ ìˆ˜ì •í•„ìš”
3. ìƒˆ í˜ë¥´ì†Œë‚˜ newbie_shaman.dart "ì¥êµ° ì‹ ë‚´ë¦¼ë°›ì€ í•˜ê¼¬ ë¬´ë‹¹" ì¶”ê°€ -> êµ¬ì²´ì  ë‚´ìš© ìˆ˜ì • ì˜ˆì •
4. ìƒˆ í˜ë¥´ì†Œë‚˜ saeongjima.dart "ìƒˆì˜¹ì§€ë§ˆ í• ë°°" ì¶”ê°€ (ê¸ì •ì  í•´ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì´ì•¼ê¸° ì§„í–‰) -> êµ¬ì²´ì  ë‚´ìš© ìˆ˜ì • ì˜ˆì •
5. ìƒˆ í˜ë¥´ì†Œë‚˜ detail_book.dart "ëª…ë¦¬ì˜ ì„œ" ì¶”ê°€ (ë””í…Œì¼í•œ ì •ë³´ë¥¼ ì›í•˜ëŠ” ì‚¬ìš©ì íƒ€ê²ŸíŒ…) -> êµ¬ì²´ì  ë‚´ìš© ìˆ˜ì • ì˜ˆì •




### âœ… ì™„ë£Œëœ ì‘ì—… (2026ë…„ 01ì›” 19ì¼)

## ğŸ“Š [Semantic Intent Routing] í† í° ìµœì í™” - AI Summary í•„í„°ë§

### ğŸ” ë¬¸ì œì  (ê¸°ì¡´ ë°©ì‹)
```
ì‚¬ìš©ì: "ìš”ì¦˜ ì—°ì• ê°€ ì˜ ì•ˆ í’€ë¦¬ëŠ”ë° ì´ìœ ê°€ ë­˜ê¹Œ?"

[ê¸°ì¡´] AI Summaryë¥¼ ê±°ì˜ í™œìš©í•˜ì§€ ì•ŠìŒ
â””â”€ sajuOriginë§Œ ì‚¬ìš© (ì‚¬ì£¼íŒ”ì, ì˜¤í–‰, ìš©ì‹  ë“± ê¸°ë³¸ ì •ë³´)
â””â”€ personality, love, career ë“± GPT-5.2 ìƒì„¸ ë¶„ì„ì€ ë¯¸ì‚¬ìš©
   (dbì˜ ai_summaries.contentì—ëŠ” ìˆì§€ë§Œ í”„ë¡¬í”„íŠ¸ì— ì•ˆ ë„£ìŒ)

ë¬¸ì œ:
âŒ ì •í™•ë„ ì†ì‹¤: GPT-5.2ê°€ ë¶„ì„í•œ ìƒì„¸ ì •ë³´ í™œìš© ëª»í•¨
âŒ ì •ë³´ ë¶€ì¡±: ì—°ì• ìš´ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ë¶„ì„ ê²°ê³¼ ì—†ìŒ
âŒ ì¼ê´€ì„± ë¶€ì¡±: ë§¤ë²ˆ Geminiê°€ ìƒˆë¡œ í•´ì„ (GPT-5.2 ë¶„ì„ ë¬´ì‹œ)
```

### âœ¨ ê°œì„  ë°©ì‹ (Intent Routing + AI Summary ì „ì²´ í™œìš©)
```
ì‚¬ìš©ì: "ìš”ì¦˜ ì—°ì• ê°€ ì˜ ì•ˆ í’€ë¦¬ëŠ”ë° ì´ìœ ê°€ ë­˜ê¹Œ?"
     â†“
[1ë‹¨ê³„] GPT-5.2 ìƒì„¸ ë¶„ì„ í™œìš© ì‹œì‘
â””â”€ personality (ì„±ê²© ë¶„ì„)     â† GPT-5.2 ë¶„ì„ ê²°ê³¼
â””â”€ love (ì—°ì• ìš´ ìƒì„¸)          â† GPT-5.2 ë¶„ì„ ê²°ê³¼
â””â”€ marriage (ê²°í˜¼ìš´)           â† GPT-5.2 ë¶„ì„ ê²°ê³¼
â””â”€ career, wealth, health...   â† GPT-5.2 ë¶„ì„ ê²°ê³¼
     â†“
[2ë‹¨ê³„] Gemini Flashë¡œ ì˜ë„ ë¶„ë¥˜ (1ì´ˆ)
     â†“
ë¶„ë¥˜ ê²°ê³¼: [LOVE] â† "ì—°ì• ì— ëŒ€í•œ ì§ˆë¬¸"
     â†“
[3ë‹¨ê³„] í•„ìš”í•œ ì„¹ì…˜ë§Œ í•„í„°ë§
â””â”€ saju_origin (ê¸°ë³¸)    â† í•­ìƒ í¬í•¨
â””â”€ wonGuk_analysis       â† í•­ìƒ í¬í•¨
â””â”€ love (ì—°ì• )           â† âœ… ë¶„ë¥˜ ê²°ê³¼ë§Œ í¬í•¨
     â†“
ê²°ê³¼:
âœ… ì •í™•ë„ í–¥ìƒ: GPT-5.2 ì—°ì• ìš´ ë¶„ì„ í™œìš©
âœ… í† í° ìµœì í™”: 750 í† í° (ë¶ˆí•„ìš”í•œ ì„¹ì…˜ ì œì™¸)
âœ… ì‘ë‹µ í’ˆì§ˆ: ì¼ê´€ëœ ë¶„ì„ ê¸°ë°˜ ìƒë‹´
```

---

### ğŸ“ êµ¬í˜„ëœ íŒŒì¼ (4ê°œ + 1ê°œ ë¬¸ì„œ)

#### 1. **Intent Classifier Service** (ì‹ ê·œ)
ğŸ“ `frontend/lib/core/services/intent_classifier_service.dart`

```dart
// ì‚¬ìš©ì ì§ˆë¬¸ â†’ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜
final result = await IntentClassifierService.classifyIntent(
  userMessage: "ì—°ì• ìš´ì´ ê¶ê¸ˆí•´ìš”",
  chatHistory: recentMessages,
  userId: userId,  // v3.0: Quota ê´€ë¦¬ìš©
);
// result.categories: [SummaryCategory.love]
// result.reason: "ì—°ì• ì— ëŒ€í•œ ì§ˆë¬¸"
```

**ì—­í• ** (v3.0 - Supabase Edge Function í†µí•©):
- Supabase `ai-gemini` Edge Function í˜¸ì¶œ (`action: "classify-intent"`)
- ì„œë²„ì—ì„œ Gemini 1.5 Flash ì‹¤í–‰ (API í‚¤ ë³´ì•ˆ ê°•í™”)
- ì‚¬ìš©ì ì§ˆë¬¸ + ìµœê·¼ ëŒ€í™” 3í„´ ì „ë‹¬
- userId íŒŒë¼ë¯¸í„°ë¡œ Quota ê´€ë¦¬ ìë™í™”
- ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜ ê²°ê³¼ ë°˜í™˜ (ìµœëŒ€ 3ê°œ)
- í† í° ì‚¬ìš©ëŸ‰ DB ìë™ ê¸°ë¡
- ì˜¤ë¥˜ ì‹œ ìë™ fallback (GENERAL)

---

#### 2. **AI Summary í•„í„°ë§** (ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •)
ğŸ“ `frontend/lib/core/services/ai_summary_service.dart`

**ì¶”ê°€ëœ ë‚´ìš©**:
```dart
// 1. ì¹´í…Œê³ ë¦¬ enum (ìƒë‹¨)
enum SummaryCategory {
  personality, love, marriage, career, 
  business, wealth, health, general
}

// 2. ë¶„ë¥˜ ê²°ê³¼ í´ë˜ìŠ¤
class IntentClassificationResult {
  final List<SummaryCategory> categories;
  final String reason;
}

// 3. í•„í„°ë§ í´ë˜ìŠ¤ (í•˜ë‹¨ì— ì¶”ê°€)
class FilteredAiSummary {
  final AiSummary original;
  final IntentClassificationResult classification;
  
  Map<String, dynamic> toFilteredJson() {
    // í•„ìš”í•œ ì„¹ì…˜ë§Œ ì¶”ì¶œ
  }
  
  int get estimatedTokenSavings {
    // ì˜ˆìƒ í† í° ì ˆì•½ë¥  ê³„ì‚°
  }
}
```

**ë³€ê²½ ìœ„ì¹˜**: íŒŒì¼ ìƒë‹¨ (line 10-50) + í•˜ë‹¨ (line 1133-)

---

#### 3. **System Prompt Builder** (ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •)
ğŸ“ `frontend/lib/features/saju_chat/data/services/system_prompt_builder.dart`

**ë³€ê²½ ë‚´ìš©**:
```dart
// [ë³€ê²½ 1] build ë©”ì„œë“œ íŒŒë¼ë¯¸í„° ì¶”ê°€ (line 41)
String build({
  AiSummary? aiSummary,
  IntentClassificationResult? intentClassification,  // â† ì¶”ê°€
  // ...
})

// [ë³€ê²½ 2] AI Summary ì¶”ê°€ ë¡œì§ (line 102-108)
if (isFirstMessage && aiSummary != null) {
  _addAiSummary(aiSummary, intentClassification);  // â† ì¶”ê°€
}

// [ë³€ê²½ 3] ìƒˆ ë©”ì„œë“œ ì¶”ê°€ (line 961-1009)
void _addAiSummary(
  AiSummary aiSummary,
  IntentClassificationResult? intentClassification,
) {
  if (intentClassification != null && !GENERAL) {
    // í•„í„°ë§ëœ ë°ì´í„°ë§Œ í¬í•¨
    final filtered = FilteredAiSummary(...);
    buffer.writeln(jsonEncode(filtered.toFilteredJson()));
  } else {
    // ì „ì²´ ë°ì´í„° í¬í•¨
    buffer.writeln(jsonEncode(aiSummary.toJson()));
  }
}
```

**ì¶”ê°€ import**: `import 'dart:convert';` (line 1)

---

#### 4. **Chat Provider** (ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •)
ğŸ“ `frontend/lib/features/saju_chat/presentation/providers/chat_provider.dart`

**ë³€ê²½ ë‚´ìš©**:

```dart
// [ë³€ê²½ 1] import ì¶”ê°€ (line 12)
import '../../../../core/services/intent_classifier_service.dart';

// [ë³€ê²½ 2] sendMessage ë©”ì„œë“œ ë‚´ë¶€ (line 674-720)
// ì²« ë©”ì‹œì§€ê°€ ì•„ë‹ ë•Œë§Œ Intent Classification ì‹¤í–‰
IntentClassificationResult? intentClassification;
if (!isFirstMessageInSession && aiSummary != null) {
  print('ğŸ¯ INTENT CLASSIFICATION');
  
  // ìµœê·¼ ëŒ€í™” 3í„´ ì¶”ì¶œ
  final recentMessages = state.messages
      .skip(state.messages.length > 6 ? state.messages.length - 6 : 0)
      .map((m) => '${m.role.name}: ${m.content}')
      .toList();
  
  intentClassification = await IntentClassifierService.classifyIntent(
    userMessage: content,
    chatHistory: recentMessages,
  );
  
  print('ğŸ“Œ ë¶„ë¥˜: ${intentClassification.categories.map((c) => c.korean).join(", ")}');
  print('ğŸ’° í† í° ì ˆì•½: ~${filtered.estimatedTokenSavings}%');
}

// [ë³€ê²½ 3] _buildFullSystemPrompt í˜¸ì¶œ (line 964-975)
final systemPrompt = _buildFullSystemPrompt(
  intentClassification: intentClassification,  // â† ì¶”ê°€
  // ...
);

// [ë³€ê²½ 4] _buildFullSystemPrompt ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ (line 489-514)
String _buildFullSystemPrompt({
  IntentClassificationResult? intentClassification,  // â† ì¶”ê°€
  // ...
})
```

---

### ğŸ¯ ì£¼ìš” ê¸°ëŠ¥ & ê°œì„  íš¨ê³¼

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì •í™•ë„ í–¥ìƒ** | â­ GPT-5.2 ìƒì„¸ ë¶„ì„ í™œìš© (ê¸°ì¡´: ë¯¸í™œìš©) |
| **í† í° ì ˆì•½** | 70-85% ì˜ˆìƒ (í•„ìš”í•œ ì„¹ì…˜ë§Œ í¬í•¨) |
| **ì‘ë‹µ í’ˆì§ˆ** | ì¼ê´€ëœ ë¶„ì„ ê¸°ë°˜ (ê¸°ì¡´: ë§¤ë²ˆ ìƒˆë¡œ í•´ì„) |
| **ì‘ë‹µ ì†ë„** | ì»¨í…ìŠ¤íŠ¸ ê¸¸ì´ ê°ì†Œë¡œ í–¥ìƒ |
| **ë¶„ë¥˜ ì†ë„** | Gemini Flash ì‚¬ìš© (1ì´ˆ ì´ë‚´) |
| **ìë™ Fallback** | ì˜¤ë¥˜ ì‹œ GENERAL ë°˜í™˜ |
| **ì²« ë©”ì‹œì§€ ì˜ˆì™¸** | í•­ìƒ ì „ì²´ ì •ë³´ í¬í•¨ |
| **ê¸°ë³¸ ì •ë³´** | saju_origin, wonGuk_analysis í•­ìƒ í¬í•¨ |

### ğŸ“ˆ ì •í™•ë„ê°€ ì¤‘ìš”í•œ ì´ìœ 

ì‚¬ì£¼ ìƒë‹´ì€ **ì •í™•ë„ê°€ ìƒëª…**ì…ë‹ˆë‹¤:
- âœ… GPT-5.2ê°€ ë¶„ì„í•œ ì—°ì• ìš´ â†’ êµ¬ì²´ì , ì •í™•í•¨
- âŒ Geminiê°€ ë§¤ë²ˆ ìƒˆë¡œ í•´ì„ â†’ ì¼ê´€ì„± ì—†ìŒ, ë¶€ì •í™•

**ì˜ˆì‹œ**:
```
[GPT-5.2 ë¶„ì„] love ì„¹ì…˜
- attraction_style: "ì ê·¹ì ì´ê³  ì—´ì •ì ì¸ êµ¬ì• "
- dating_pattern: "ë¹ ë¥´ê²Œ ì§„ì „ë˜ë‚˜ ì‹ëŠ” ê²ƒë„ ë¹ ë¦„"
- ideal_partner_traits: ["ì°¨ë¶„í•œ ì„±ê²©", "ê²½ì œì  ì•ˆì •"]

â†’ ì´ ì •í™•í•œ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ Geminiê°€ ìƒë‹´
â†’ ì¼ê´€ë˜ê³  ì •í™•í•œ ë‹µë³€ ê°€ëŠ¥
```

---

### ğŸš€ ë°°í¬ ë° ì‹¤í–‰ ë°©ë²•

**v3.0: Supabase Edge Function í†µí•©** (ë³´ì•ˆ ê°•í™”!)
- âœ… API í‚¤ê°€ ì„œë²„ì—ë§Œ ì¡´ì¬ (í´ë¼ì´ì–¸íŠ¸ ë…¸ì¶œ ì—†ìŒ)
- âœ… Quota ê´€ë¦¬ ìë™í™”
- âœ… í† í° ì‚¬ìš©ëŸ‰ DB ìë™ ê¸°ë¡
- âœ… ì¼ê´€ëœ ì•„í‚¤í…ì²˜ (ëª¨ë“  Gemini í˜¸ì¶œì´ Edge Function ê²½ìœ )

**ë°°í¬ ìˆœì„œ**:
```bash
# 1. Edge Function ë°°í¬ (ìµœì´ˆ 1íšŒë§Œ)
# supabase/functions/ai-gemini/after.ts ë‚´ìš©ì„ index.tsë¡œ ë³µì‚¬
supabase functions deploy ai-gemini

# 2. Flutter ì•± ì‹¤í–‰
cd frontend
flutter pub get
flutter run

# 3. í…ŒìŠ¤íŠ¸ (ì½˜ì†” ë¡œê·¸ í™•ì¸)
# - ì±„íŒ… ì‹œì‘
# - "ìš”ì¦˜ ì—°ì• ê°€ ì˜ ì•ˆ í’€ë¦¬ëŠ”ë° ì´ìœ ê°€ ë­˜ê¹Œ?" ì…ë ¥
# - ì½˜ì†” ë¡œê·¸ í™•ì¸:
#   ğŸ¯ INTENT CLASSIFICATION (v7.0)
#   ğŸ“Œ ë¶„ë¥˜ ê²°ê³¼: ì—°ì• 
#   ğŸ’° í† í° ì ˆì•½ ì˜ˆìƒ: ~85%
#   ğŸ’¡ ì´ìœ : ì—°ì• ì— ëŒ€í•œ ì§ˆë¬¸
```

**âœ… ë³´ì•ˆ ê°œì„ **:
- API í‚¤ê°€ Supabase ì„œë²„ í™˜ê²½ë³€ìˆ˜ì—ë§Œ ì¡´ì¬
- í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” Edge Functionë§Œ í˜¸ì¶œ (API í‚¤ ë…¸ì¶œ ì—†ìŒ)
- ëª¨ë“  í† í° ì‚¬ìš©ëŸ‰ì´ DBì— ìë™ ê¸°ë¡

---

### ğŸ“š ì°¸ê³  ë¬¸ì„œ

ğŸ“„ **ìƒì„¸ README**: `frontend/lib/core/services/README_INTENT_ROUTING.md`
- ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
- ë™ì‘ ì˜ˆì‹œ
- íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
- ì„±ëŠ¥ ì§€í‘œ

ğŸ“„ **ë¡œê·¸ ì˜ˆì‹œ**: `frontend/lib/core/services/LOG_EXAMPLES.md`
- ì±„íŒ… ì§„í–‰ ì‹œ ë¡œê·¸ ì˜ˆì‹œ
- ì¹´í…Œê³ ë¦¬ë³„ ë¡œê·¸ í˜•ì‹
- ë¬¸ì œ ë°œìƒ ì‹œ í™•ì¸ ë°©ë²•

---

### ğŸ’¬ ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

**ì‚¬ìš©ì**: "ìš”ì¦˜ ì—°ì• ê°€ ì˜ ì•ˆ í’€ë¦¬ëŠ”ë° ì´ìœ ê°€ ë­˜ê¹Œ?"

**ë¡œê·¸ (ì½˜ì†”)**:
```
ğŸ¯ INTENT CLASSIFICATION
   ğŸ“Œ ë¶„ë¥˜: ì—°ì• 
   ğŸ’° í† í° ì ˆì•½: ~85%

ğŸ“‹ AI SUMMARY ì°¸ì¡° ì •ë³´
   ğŸ¯ ì°¸ì¡° ë²”ìœ„: ì„ íƒì  í•„í„°ë§
   ğŸ“¦ í¬í•¨ ì„¹ì…˜:
      - saju_origin âœ…
      - wonGuk_analysis âœ…  
      - ğŸ’• ì—°ì•  (LOVE) âœ…
```

**ê²°ê³¼**: 
- âœ… GPT-5.2 ì—°ì• ìš´ ë¶„ì„ í™œìš© (ì •í™•ë„ â†‘)
- âœ… ë¶ˆí•„ìš”í•œ ì„¹ì…˜ ì œì™¸ (í† í° 85% â†“)
- âœ… ì¼ê´€ëœ ë¶„ì„ ê¸°ë°˜ ìƒë‹´ (í’ˆì§ˆ â†‘)

### âš ï¸ í•´ê²°í•  ë¬¸ì œ

1. í˜¸ì¹­ rule ìˆ˜ì • í•„ìš” -> ì‚¬ìš©ì ë°ì´í„°ì—ì„œ ì„±ë³„ í™•ì¸ í›„ í•´ë‹¹ ì„±ë³„ì— ë”°ë¼ í˜ë¥´ì†Œë‚˜ì—ê²Œ í˜¸ì¹­ ì ˆëŒ€ì  ë£°ë¡œ í”½ìŠ¤
2. ë…¸ì¼ì´ìŠˆ,,. ì œë¯¸ë‚˜ì´ë¥¼ ì“°ëŠ”ë° ì§€í”¼í‹°ë§Œí¼ì´ë‚˜ ì¬ë¯¸ê°€ ì—†ìŒ ì´ê±° ì–´ë–¤ì‹ìœ¼ë¡œ ìˆ˜ì •í•˜ë©´ ì¢‹ì„ì§€ ì¡°ì–¸ì„ ì–»ì–´ë´ì•¼ í•  ë“¯
3. greeting ë‹µë³€ ê¸¸ì´ ì œí•œ (3ì¤„?) í›„ ë‹¤ìŒ ì±„íŒ… ì œì•ˆ (ë¬´ì—‡ì´ ê¶ê¸ˆí•œê°€ìš”? 00? 00?)
4. êµ¬ì²´ì  ì§ˆë¬¸ì´ ì•„ë‹Œ ë…¸ê°€ë¦¬ ëŒ€í™”ëŠ” ë‹µë³€ì„ ì§§ê²Œ í•˜ë„ë¡ ìˆ˜ì • 
5. 3, 4ëŠ” chat_provider.dart > _buildFullSystemPrompt ë©”ì„œë“œì—ì„œ ì „ì²´ í˜ë¥´ì†Œë‚˜ ì ˆëŒ€ ê·œì¹™ìœ¼ë¡œ ì ìš© ì˜ˆì •
6. detail_book.dart ë‹µë³€ ê¸¸ì´ ìˆ˜ì • (ë„ˆë¬´ ê¸º)
7. ì•”íŠ¼ saeongjima.dartì™€ detail_book.dartëŠ” ê±°ì§„ ë”ë¯¸ë¼ê³  ìƒê°í•´ì£¼ë©´ ë ë“¯ìš” ë™í˜„ì˜¤ë¹  ì²´í¬ í›„ ë°©í–¥ì„± í™•ì¸ ë¶€íƒ