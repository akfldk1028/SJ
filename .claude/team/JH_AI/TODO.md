# JH_AI - GPT-5.2 사주 분석 TODO

> 작성일: 2024-12-21
> 담당: JH_AI (GPT-5.2 정확한 사주 분석)

---

## 핵심 원칙

**GPT-5.2 Responses API + ReasoningEffort.high = 정확도 최우선**

```
사용자 입력 (생년월일시)
    ↓
만세력 계산 (4주 8자)
    ↓
GPT-5.2 분석 (정확한 파싱)
    ↓
JSON 결과 → Jina(Gemini)에게 전달
```

---

## 우선순위 가이드

| 우선순위 | 설명 |
|----------|------|
| **P0** | MVP 필수 - 앱 출시 전 완료 |
| **P1** | 핵심 기능 - MVP 직후 |
| **P2** | 고급 분석 - 추후 |

---

## Phase 1: 기본 구성 (P0)

### 1.1 사주팔자 4주 구성

```
📁 frontend/lib/AI/jh/analysis/
├── four_pillars_parser.dart    [ ] 4주 파싱
└── base_saju_model.dart        [ ] 기본 모델
```

| 항목 | 구성 | 상태 |
|------|------|------|
| 년주 | 천간 + 지지 | [ ] |
| 월주 | 천간 + 지지 | [ ] |
| 일주 | 천간 + 지지 (일간 = 본인) | [ ] |
| 시주 | 천간 + 지지 | [ ] |

### 1.2 오행 분포 분석

```dart
// 목(木), 화(火), 토(土), 금(金), 수(水)
class OhaengAnalysis {
  final Map<Ohaeng, int> distribution;  // 각 오행 개수
  final Ohaeng? strongest;              // 가장 강한 오행
  final Ohaeng? weakest;                // 가장 약한 오행
  final List<Ohaeng> missing;           // 없는 오행
}
```

- [ ] 오행 개수 카운팅
- [ ] 강약 판단
- [ ] 결핍 오행 판단

### 1.3 음양 균형 분석

- [ ] 천간 음양 분석
- [ ] 지지 음양 분석
- [ ] 전체 음양 비율

---

## Phase 2: 십성 & 운성 (P0)

### 2.1 십성/십신 (10가지)

```
📁 frontend/lib/AI/jh/analysis/
└── ten_gods_analyzer.dart    [ ] 십성 분석
```

| 분류 | 십성 | 설명 |
|------|------|------|
| 비겁 | 비견, 겁재 | 형제, 경쟁 |
| 식상 | 식신, 상관 | 표현, 재능 |
| 재성 | 편재, 정재 | 재물, 아버지 |
| 관성 | 편관, 정관 | 직장, 남편 |
| 인성 | 편인, 정인 | 학문, 어머니 |

- [ ] 일간 기준 십성 계산
- [ ] 년월일시별 십성 배치
- [ ] 십성 강약 분석

### 2.2 12운성/포태법 (12가지)

```
📁 frontend/lib/AI/jh/analysis/
└── twelve_stages_analyzer.dart    [ ] 12운성 분석
```

| 순서 | 운성 | 의미 |
|------|------|------|
| 1 | 태(胎) | 잉태 |
| 2 | 양(養) | 양육 |
| 3 | 장생(長生) | 탄생 |
| 4 | 목욕(沐浴) | 성장 |
| 5 | 관대(冠帶) | 성인 |
| 6 | 건록(建祿) | 전성기 |
| 7 | 제왕(帝旺) | 최고점 |
| 8 | 쇠(衰) | 쇠퇴 |
| 9 | 병(病) | 병듦 |
| 10 | 사(死) | 죽음 |
| 11 | 묘(墓) | 무덤 |
| 12 | 절(絶) | 절멸 |

- [ ] 일간 기준 12운성 계산
- [ ] 년월일시별 12운성 배치

### 2.3 지장간 (본기/중기/여기)

```
📁 frontend/lib/AI/jh/analysis/
└── hidden_stems_analyzer.dart    [ ] 지장간 분석
```

| 지지 | 본기 | 중기 | 여기 |
|------|------|------|------|
| 자(子) | 계 | - | - |
| 축(丑) | 기 | 계 | 신 |
| 인(寅) | 갑 | 병 | 무 |
| ... | ... | ... | ... |

- [ ] 12지지별 지장간 매핑
- [ ] 지장간 십성 분석
- [ ] 일지 지장간 중요도 분석

---

## Phase 3: 간지 관계 ★핵심★ (P0)

### 3.1 천간 관계

```
📁 frontend/lib/AI/jh/analysis/
└── heavenly_stems_relations.dart    [ ] 천간 관계
```

#### 천간합 (5가지)
| 합 | 조합 | 화오행 |
|----|------|--------|
| 갑기합 | 갑 + 기 | 토 |
| 을경합 | 을 + 경 | 금 |
| 병신합 | 병 + 신 | 수 |
| 정임합 | 정 + 임 | 목 |
| 무계합 | 무 + 계 | 화 |

- [ ] 천간합 탐지
- [ ] 화오행 성립 여부

#### 천간충 (4가지)
| 충 | 조합 |
|----|------|
| 갑경충 | 갑 ↔ 경 |
| 을신충 | 을 ↔ 신 |
| 병임충 | 병 ↔ 임 |
| 정계충 | 정 ↔ 계 |

- [ ] 천간충 탐지
- [ ] 충의 영향 분석

### 3.2 ★★★ 합충형해파 (지지 관계) ★★★

```
📁 frontend/lib/AI/jh/analysis/
└── earthly_branches_relations.dart    [ ] 합충형해파
```

#### (1) 합(合) - 3종류

**육합 (6가지)**
| 합 | 조합 | 화오행 |
|----|------|--------|
| 자축합 | 子 + 丑 | 토 |
| 인해합 | 寅 + 亥 | 목 |
| 묘술합 | 卯 + 戌 | 화 |
| 진유합 | 辰 + 酉 | 금 |
| 사신합 | 巳 + 申 | 수 |
| 오미합 | 午 + 未 | 토 |

- [ ] 육합 탐지
- [ ] 화오행 성립 여부

**삼합 (4가지)**
| 합 | 조합 | 화오행 |
|----|------|--------|
| 인오술 | 寅 + 午 + 戌 | 화국 |
| 사유축 | 巳 + 酉 + 丑 | 금국 |
| 신자진 | 申 + 子 + 辰 | 수국 |
| 해묘미 | 亥 + 卯 + 未 | 목국 |

- [ ] 삼합 탐지 (완전/반합)
- [ ] 화국 성립 여부

**방합 (4가지)**
| 합 | 조합 | 방위/계절 |
|----|------|-----------|
| 인묘진 | 寅 + 卯 + 辰 | 동방/봄 (목) |
| 사오미 | 巳 + 午 + 未 | 남방/여름 (화) |
| 신유술 | 申 + 酉 + 戌 | 서방/가을 (금) |
| 해자축 | 亥 + 子 + 丑 | 북방/겨울 (수) |

- [ ] 방합 탐지
- [ ] 계절 오행 강화 분석

#### (2) 충(沖) - 6가지

| 충 | 조합 | 의미 |
|----|------|------|
| 자오충 | 子 ↔ 午 | 수화충돌 |
| 축미충 | 丑 ↔ 未 | 토토충돌 |
| 인신충 | 寅 ↔ 申 | 목금충돌 |
| 묘유충 | 卯 ↔ 酉 | 목금충돌 |
| 진술충 | 辰 ↔ 戌 | 토토충돌 |
| 사해충 | 巳 ↔ 亥 | 화수충돌 |

- [ ] 육충 탐지
- [ ] 충의 길흉 판단
- [ ] 충으로 인한 합 해소 분석

#### (3) 형(刑) - 삼형/자형

**삼형 (3가지)**
| 형 | 조합 | 이름 |
|----|------|------|
| 인사신형 | 寅 + 巳 + 申 | 무은지형 |
| 축술미형 | 丑 + 戌 + 未 | 지세지형 |
| 자묘형 | 子 + 卯 | 무례지형 |

**자형 (4가지)**
| 형 | 조합 |
|----|------|
| 진진자형 | 辰 + 辰 |
| 오오자형 | 午 + 午 |
| 유유자형 | 酉 + 酉 |
| 해해자형 | 亥 + 亥 |

- [ ] 삼형 탐지
- [ ] 자형 탐지
- [ ] 형의 영향 분석

#### (4) 해(害) - 6가지

| 해 | 조합 |
|----|------|
| 자미해 | 子 ↔ 未 |
| 축오해 | 丑 ↔ 午 |
| 인사해 | 寅 ↔ 巳 |
| 묘진해 | 卯 ↔ 辰 |
| 신해해 | 申 ↔ 亥 |
| 유술해 | 酉 ↔ 戌 |

- [ ] 육해 탐지
- [ ] 해의 영향 분석

#### (5) 파(破) - 6가지

| 파 | 조합 |
|----|------|
| 자유파 | 子 ↔ 酉 |
| 축진파 | 丑 ↔ 辰 |
| 인해파 | 寅 ↔ 亥 |
| 묘오파 | 卯 ↔ 午 |
| 사신파 | 巳 ↔ 申 |
| 미술파 | 未 ↔ 戌 |

- [ ] 육파 탐지
- [ ] 파의 영향 분석

### 3.3 특수 관계

#### 원진 (6가지)
| 원진 | 조합 |
|------|------|
| 자미 | 子 ↔ 未 |
| 축오 | 丑 ↔ 午 |
| 인유 | 寅 ↔ 酉 |
| 묘신 | 卯 ↔ 申 |
| 진해 | 辰 ↔ 亥 |
| 사술 | 巳 ↔ 戌 |

- [ ] 원진 탐지

#### 귀문
| 귀문 | 조합 |
|------|------|
| 묘유 | 卯 ↔ 酉 |
| 술진 | 戌 ↔ 辰 |
| 사해 | 巳 ↔ 亥 |

- [ ] 귀문 탐지

#### 공망
- [ ] 순중공망 계산
- [ ] 시공망 계산

---

## Phase 4: 신살 (P1)

### 4.1 12신살

```
📁 frontend/lib/AI/jh/analysis/
└── twelve_spirits_analyzer.dart    [ ] 12신살
```

| 번호 | 신살 | 의미 |
|------|------|------|
| 1 | 겁살 | 재난, 도난 |
| 2 | 재살 | 재앙 |
| 3 | 천살 | 하늘의 재난 |
| 4 | 지살 | 땅의 재난 |
| 5 | 년살(도화) | 색정, 매력 |
| 6 | 월살 | 이별 |
| 7 | 망신살 | 망신 |
| 8 | 장성살 | 권위 |
| 9 | 반안살 | 안정 |
| 10 | 역마살 | 이동, 변화 |
| 11 | 육해살 | 질병 |
| 12 | 화개살 | 예술, 종교 |

- [ ] 년지 기준 12신살 계산
- [ ] 신살 영향 해석

### 4.2 길신/귀인

| 귀인 | 의미 |
|------|------|
| 천을귀인 | 최고 귀인, 어려움에 도움 |
| 문창귀인 | 학문, 시험 |
| 학당귀인 | 배움, 교육 |
| 천덕귀인 | 하늘의 덕 |
| 월덕귀인 | 달의 덕 |
| 암록 | 숨은 복록 |
| 천관귀인 | 관직 |
| 금여록 | 재물 |

- [ ] 각 귀인 계산
- [ ] 길신 영향 해석

### 4.3 흉신

| 흉신 | 의미 |
|------|------|
| 양인살 | 강한 기운, 수술 |
| 백호대살 | 사고, 수술 |
| 도화살 | 색정, 바람 |
| 괴강살 | 강한 성격 |

- [ ] 흉신 탐지
- [ ] 흉신 영향 해석

---

## Phase 5: 고급 분석 (P2)

### 5.1 용신 (用神)

```
📁 frontend/lib/AI/jh/analysis/
└── yongshin_analyzer.dart    [ ] 용신 분석
```

| 방법 | 설명 |
|------|------|
| 억부법 | 강한 것 억제, 약한 것 보완 |
| 조후법 | 한난조습 조절 |
| 통관법 | 충돌 오행 중재 |
| 병약법 | 병을 찾아 약으로 치료 |

- [ ] 일간 강약 판단
- [ ] 용신 선정
- [ ] 희신/기신/구신 판단

### 5.2 격국 (格局)

```
📁 frontend/lib/AI/jh/analysis/
└── geokguk_analyzer.dart    [ ] 격국 분석
```

**정격 (8가지)**
| 격 | 조건 |
|----|------|
| 식신격 | 식신이 월지에 투간 |
| 상관격 | 상관이 월지에 투간 |
| 편재격 | 편재가 월지에 투간 |
| 정재격 | 정재가 월지에 투간 |
| 편관격 | 편관이 월지에 투간 |
| 정관격 | 정관이 월지에 투간 |
| 편인격 | 편인이 월지에 투간 |
| 정인격 | 정인이 월지에 투간 |

**종격 (5가지)**
| 격 | 조건 |
|----|------|
| 종왕격 | 비겁이 매우 강함 |
| 종강격 | 인성이 매우 강함 |
| 종아격 | 식상이 매우 강함 |
| 종재격 | 재성이 매우 강함 |
| 종살격 | 관성이 매우 강함 |

- [ ] 격국 판정
- [ ] 격국 길흉 분석

### 5.3 납음오행

```
📁 frontend/lib/AI/jh/analysis/
└── napeum_analyzer.dart    [ ] 납음 분석
```

- [ ] 60갑자 납음 매핑
- [ ] 납음 오행 분석

### 5.4 대운/세운

```
📁 frontend/lib/AI/jh/analysis/
└── fortune_cycles_analyzer.dart    [ ] 운세 분석
```

- [ ] 대운 계산 (10년 주기)
- [ ] 세운 분석 (년도별)
- [ ] 월운 분석 (월별)

---

## GPT-5.2 프롬프트 구조

```dart
// frontend/lib/AI/common/prompts/saju_analysis_prompt.dart

const String SAJU_ANALYSIS_SYSTEM_PROMPT = '''
당신은 사주팔자 전문 분석가입니다.

## 분석 순서 (정확도 우선)
1. 4주 8자 확인
2. 오행 분포 분석
3. 십성 배치 분석
4. 12운성 분석
5. 지장간 분석
6. 천간 합/충 분석
7. 지지 합충형해파 분석 ★
8. 신살 분석
9. 용신 선정
10. 격국 판정

## 출력 형식
JSON 형식으로 정확하게 출력하세요.
''';
```

---

## 체크리스트

### Phase 1: 기본 (P0)
- [ ] 4주 파싱
- [ ] 오행 분포
- [ ] 음양 균형

### Phase 2: 십성/운성 (P0)
- [ ] 십성/십신 (10가지)
- [ ] 12운성 (12가지)
- [ ] 지장간

### Phase 3: 간지 관계 (P0) ★핵심★
- [ ] 천간합 (5가지)
- [ ] 천간충 (4가지)
- [ ] **육합** (6가지)
- [ ] **삼합** (4가지)
- [ ] **방합** (4가지)
- [ ] **육충** (6가지)
- [ ] **삼형/자형**
- [ ] **육해** (6가지)
- [ ] **육파** (6가지)
- [ ] 원진, 귀문, 공망

### Phase 4: 신살 (P1)
- [ ] 12신살
- [ ] 길신/귀인
- [ ] 흉신

### Phase 5: 고급 (P2)
- [ ] 용신 (억부/조후/통관/병약)
- [ ] 격국 (정격/종격)
- [ ] 납음오행
- [ ] 대운/세운

---

## Jina와 연동

```
[JH_AI]                        [Jina]
GPT-5.2 분석 → JSON 결과 → Gemini 대화 생성 → 최종 응답
```

- JH_AI는 **정확한 분석**에 집중
- Jina는 **재미있는 대화**로 변환
- JSON 인터페이스로 연결

---

## 일정

| Phase | 예상 | 비고 |
|-------|------|------|
| Phase 1 | 1일 | 기본 구성 |
| Phase 2 | 2일 | 십성/운성 |
| Phase 3 | 3일 | 합충형해파 ★ |
| Phase 4 | 2일 | 신살 |
| Phase 5 | 3일 | 고급 분석 |

**총: 약 11일**
